## 설정하기

### 스프링 부트 스타터

https://start.spring.io

| 프로젝트 정보 | 세부 정보                     |
| ------------- | ----------------------------- |
| Project       | Gradle - Groovy               |
| Language      | Java                          |
| Spring Boot   | 3.x.x                         |
| Group         | group                         |
| Artifact      | name                          |
| Name          | name                          |
| Package name  | group.name                    |
| Packaging     | Jar                           |
| Java          | 17 또는 21                    |
| Dependencies  | Spring Web, Lombok, Thymeleaf |

### gradle 설정

> Settings -> Build, Execution, Deployment -> Build Tools -> Gradle
>
> Build and run using: Gradle IntelliJ IDEA
>
> Run tests using: Gradle IntelliJ IDEA

### 롬복 설정

> Settings -> plugins -> Lombok 검색 및 실행 -> 재시작
>
> Settings -> Annotation Processors -> Enable annotation processing 체크 -> 재시작

### Postman 설치

> [Postman](https://www.postman.com/download)

## Log 기능

```java
@Slf4j
@RestController
public class LogTestController {

    // @Slf4j을 쓰기 않을 경우 아래 코드 입력
    // private final Logger log = LoggerFactory.getLogger(getClass());

    @RequestMapping("/log-test")
    public String logTest() {

        String str = "log test";

        log.trace("trace {}", str); // + 연산 사용하지 않기 (ex. log.trace("trace " + str))
        log.debug("debug {}", str);
        log.info("info {}", str);
        log.warn("warn {}", str);
        log.error("error {}", str);

        return "log test";
    }
}
```

```
# application.properties

# 전체 로그 레벨 설정, 기본 info로 설정되어있음
# trace > debug > info > warn > error
logging.level.root=info

# group.name 패키지와 그 하위 로그 레벨 설정
logging.level.group.name=debug
```

## Request Mapping

#### 매핑 종류

| 종류            |
| --------------- |
| @RequestMapping |
| @GetMapping     |
| @PostMapping    |
| @PutMapping     |
| @DeleteMapping  |
| @PatchMapping   |

#### 기본 매핑

```java
// @RequestMapping("/request-mapping")
// @RequestMapping("/request-mapping", "/request-mapping2")
// @RequestMapping(value = "/request-mapping", method = RequestMethod.GET) <- GET, POST, PUT, DELETE, PATCH
@RequestMapping("/request-mapping")
public String requestMapping() {

    return "request mapping"
}
```

```java
@GetMapping("/request-mapping")
public String requestMapping() {

    return "request mapping"
}
```

#### PathVariable 사용

```java
@GetMapping("/request-mapping/{data}")
public String requestMapping(@PathVariable("data") String data) { // 이름이 같으면 생략 가능 ex. @PathVariable String data

    return "request mapping"
}
```

#### params

```java
// 파라미터 매핑
// params = "mode",
// params = "!mode"
// params = "mode=debug"
// params = "mode!=debug"
// params = {"mode=debug","data=good"}
@GetMapping(value = "/request-mapping", params = "mode=debug")
public String requestMapping() {

    return "request mapping"
}
```

#### headers

```java
// 헤더 매핑
// headers = "mode",
// headers = "!mode"
// headers = "mode=debug"
// headers = "mode!=debug"
// headers = {"mode=debug","data=good"}
@GetMapping(value = "/request-mapping", headers = "mode=debug")
public String requestMapping() {

    return "request mapping"
}
```

#### consumes

```java
// content-type 매핑
// consumes = "application/json"
// consumes = "!application/json"
// consumes = "application/*"
// consumes = "*/*"
// consumes = MediaType.APPLICATION_JSON_VALUE <- APPLICATION_JSON_VALUE, APPLICATION_FORM_URLENCODED_VALUE, TEXT_PLAIN_VALUE
// consumes = {"text/plain", "application/json"}
// consumes = "application/json;charset=UTF-8"
@GetMapping(value = "/request-mapping", consumes = "application/json")
public String requestMapping() {

    return "request mapping"
}
```

#### produces

```java
// accept 매핑
// produces = "text/html"
// produces = "!text/html"
// produces = "text/*"
// produces = "*/*"
// produces = MediaType.TEXT_HTML_VALUE <- APPLICATION_JSON_VALUE, APPLICATION_FORM_URLENCODED_VALUE, TEXT_PLAIN_VALUE
// produces = {"text/plain", "text/html"}
// produces = "text/html;charset=UTF-8"
@GetMapping(value = "/request-mapping", produces = "text/html")
public String requestMapping() {

    return "request mapping"
}
```

## Request

### Header

```java
@RequestMapping("/request-header")
public String requestHeader(HttpServletRequest request,
                            HttpServletResponse response,
                            HttpMethod httpMethod, // GET
                            Locale locale, // ko_KR
                            @RequestHeader MultiValueMap<String, String> headerMap, // {content-type=[application/json], user-agent=[PostmanRuntime/7.36.0], ...}
                            @RequestHeader("host") String host, // localhost:8080
                            @CookieValue(value = "myCookie", required = false) String cookie // null
) {

    return "ok";
}
```

### Parameter

```java
// HttpServletRequest
@RequestMapping("/request-parameter")
public String requestParameter(HttpServletRequest request) {

    String firstName = request.getParameter("firstName");
    String lastName = request.getParameter("lastName");

    return "request parameter"
}
```

```java
// @RequestParam
@RequestMapping("/request-parameter")
public String requestParameter(@RequestParam("firstName") String firstName, @RequestParam("lastName") String lastName) {
                               // @RequestParam String firstName, @RequestParam String lastName 와 동일
                               // String firstName, String lastName 와 동일
                               // required, defaultValue 설정 가능
    return "request parameter"
}
```

```java
// @RequestParam
@RequestMapping("/request-parameter")
public String requestParameter(@RequestParam Map<String, Object> data) {
                               // 이름이 중복일 경우 MultiValueMap도 사용 가능

    String firstName = data.get("firstName")
    String lastName = data.get("lastName")

    return "request parameter";
}
```

```java
// @ModelAttribute
@RequestMapping("/request-parameter")
public String requestParameter(@ModelAttribute JsonData data) {
                               // @ModelAttribute 생략 가능

    String firstName = data.getFirstName("firstName")
    String lastName = data.getLastName("lastName")

    return "request parameter";
}
```

### Body - String

```java
// HttpServletRequest
@PostMapping("/request-body-string")
public String requestBodyString(HttpServletRequest request) {

    ServletInputStream inputStream = request.getInputStream();
    String body = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8);

    return "request body string";
}
```

```java
// InputStream
@PostMapping("/request-body-string")
public String requestBodyString(InputStream inputStream) {

    String body = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8);

    return "request body string";
}
```

```java
// HttpEntity<String>
@PostMapping("/request-body-string")
public String requestBodyString(HttpEntity<String> httpEntity) {
                                // header, body 정보 조회 O, parameter 정보 조회 X
                                // RequestEntity 대신 사용 가능

    String body = httpEntity.getBody();

    return "request body string";
}
```

```java
// @RequestBody
@PostMapping("/request-body-string")
public String requestBodyString(@RequestBody String body) {

    return "request body string";
}
```

### Body - Json

```java
// HttpServletRequest
@PostMapping("/request-body-json")
public String requestBodyJson(HttpServletRequest request) {

    ServletInputStream inputStream = request.getInputStream();
    String body = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8);
    JsonData data = objectMapper.readValue(body, JsonData.class);

    return "request body string";
}
```

```java
// @RequestBody
@PostMapping("/request-body-json")
public String requestBodyJson(@RequestBody String body) {

    JsonData data = objectMapper.readValue(body, JsonData.class);

    return "request body string";
}
```

```java
// HttpEntity
@PostMapping("/request-body-json")
public String requestBodyJson(HttpEntity<JsonData> httpEntity) {

    JsonData data = httpEntity.getBody();

    return "request body string";
}
```

```java
// @RequestBody
@PostMapping("/request-body-json")
public String requestBodyJson(@RequestBody JsonData data) {

    return "request body string";
}
```

## Response

### Static Resource

> 경로 : src/main/resources/static
>
> http://localhost:8080/test.html 처럼 정적 리소스 요청

### View Template

> 경로 : src/main/resources/templates

```java
// ModelAndView
@GetMapping("/response-view-template")
public ModelAndView responseViewTemplate() {

    ModelAndView mv = new ModelAndView("test/test")
                            .addObject("data", "hello");

    return mv;
}
```

```java
// Model
@GetMapping("/response-view-template")
public String responseViewTemplate(Model model) {

    model.addAttribute("data", "hello");

    return "test/test"; // mapping url과 같다면 void로 리턴 가능
                        // 조건: @Controller 사용하고, HTTP 메시지 바디를 처리하는 파라미터가 없을 때
}
```

### Body - String

```java
// HttpServletResponse
@GetMapping("/response-body-string")
public void responseBodyString(HttpServletResponse response)  {

    response.getWriter().write("response body string");
}
```

```java
// Writer
@GetMapping("/request-body-string")
public void responseBodyString(Writer writer)  {

    writer.write("response body string");
}
```

```java
// HttpEntity
@GetMapping("/response-body-string")
public HttpEntity<String> responseBodyString() {

    return new HttpEntity<>("response body string", HttpStatus.OK); // ResponseEntity도 사용 가능
}
```

```java
// @ResponseBody
@ResponseBody
@GetMapping("/response-body-string")
public String responseBodyString() {

    return "response body string";
}
```

### Body - Json

```java
// HttpEntity
@GetMapping("/response-body-json")
public HttpEntity<HelloData> responseBodyJson() {

    JsonData data = new JsonData();
    data.setFirstName("Gildong");
    data.setLastName("Hong");

    return new HttpEntity<>(data, HttpStatus.OK);
}
```

```java
// ResponseBody
@ResponseStatus(HttpStatus.OK)
@ResponseBody
@GetMapping("/response-body-json")
public JsonData responseBodyJson() {

    JsonData data = new JsonData();
    data.setFirstName("Gildong");
    data.setLastName("Hong");

    return data;
}
```

## 정리

| 요청, 응답 요소              | 이용하면 좋은 어노테이션 또는 클래스 |
| ---------------------------- | ------------------------------------ |
| request header               | @RequestHeader                       |
| request parameter            | @RequestParam, @ModelAttribute       |
| request body                 | @RequestBody                         |
| request header, body (동시)  | HttpEntity<T>, RequestEntity<T>      |
| response body                | @ResponseBody                        |
| response header, body (동시) | HttpEntity<T>, ResponseEntity<T>     |
