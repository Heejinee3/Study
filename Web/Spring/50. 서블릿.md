## 설정하기

### 스프링 부트 스타터

> [스프링 부트 스타터](https://start.spring.io)

| 프로젝트 정보 | 세부 정보          |
| ------------- | ------------------ |
| Project       | Gradle - Groovy    |
| Language      | Java               |
| Spring Boot   | 3.x.x              |
| Group         | group              |
| Artifact      | name               |
| Name          | name               |
| Package name  | group.name         |
| Packaging     | War                |
| Java          | 17 또는 21         |
| Dependencies  | Spring Web, Lombok |

### gradle 설정

> Settings -> Build, Execution, Deployment -> Build Tools -> Gradle
>
> Build and run using: Gradle IntelliJ IDEA
>
> Run tests using: Gradle IntelliJ IDEA
>
> IntelliJ 무료 버전의 경우 Gradle로 설정 (War일 경우 문제 발생)

### 롬복 설정

> Settings -> plugins -> Lombok 검색 및 실행 -> 재시작
>
> Settings -> Annotation Processors -> Enable annotation processing 체크 -> 재시작

### Postman 설치

> [Postman](https://www.postman.com/download)

## Servlet

### 기본 구성

```java
@ServletComponentScan
@SpringBootApplication
public class ServletApplication {

	public static void main(String[] args) {
		SpringApplication.run(ServletApplication.class, args);
	}

}
```

```java
@WebServlet(name = "testServlet", urlPatterns = "/test")
public class TestServlet extends HttpServlet {

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        // request, response 구현

    }
}
```

### Request (header)

```java
// start line 조회
String method      = request.getMethod();      // GET
String protocol    = request.getProtocol();    // HTTP/1.1
String scheme      = request.getScheme();      // http
String requestURL  = request.getRequestURL();  // http://localhost:8080/test
String requestURI  = request.getRequestURI();  // /test
String queryString = request.getQueryString(); // firstName=Gildong&lastName=Hong
String isSecure    = request.isSecure();       // false

// header 조회
Enumeration<String> headerNames = request.getHeaderNames();  // Enumeration(host, accept, ...), header name의 collection
String header                   = request.getHeader("host"); // header 정보

/* 방법 1.
Enumeration<String> headerNames = request.getHeaderNames();
while (headerNames.hasMoreElements()) {
    String headerName = headerNames.nextElement();
    String header = request.getHeader(headerName);
}*/

/* 방법 2.
request.getHeaderNames().asIterator()
    .forEachRemaining(headerName -> request.getHeader(headerName)); */

// 그외 정보 조회
String serverName        = request.getServerName();        // localhost
String serverPort        = request.getServerPort();        // 8080
String locales           = request.getLocales();           // Enumeration(ko_KR, ko, en_US, en, ...), locale의 collection
String contentType       = request.getContentType();       // text/plain
String contentLength     = request.getContentLength();     // 6
String characterEncoding = request.getCharacterEncoding(); // UTF-8
String remoteHost        = request.getRemoteHost();        // 0:0:0:0:0:0:0:1
String remoteAddr        = request.getRemoteAddr();        // 0:0:0:0:0:0:0:1
String remotePort        = request.getRemotePort();        // 57451
String localName         = request.getLocalName();         // 0:0:0:0:0:0:0:1
String localAddr         = request.getLocalAddr();         // 0:0:0:0:0:0:0:1
String localPort         = request.getLocalPort();         // 8080

// 쿠키 조회
Cookie cookie      = request.getCookies(); // cookie
String cookieName  = cookie.getName();     // cookie name
String cookieValue = cookie.getValue();    // cookie value
```

### Request (parameter, body)

```java
// GET, POST(application/x-www-form-urlencoded) 정보 조회
String firstName    = request.getParameter("firstName");       // parameterName이 1개일 때
String[] firstNames = request.getParameterValues("firstName"); // parameterName이 중복일 때(2개 이상)

// text/plain 정보 조회
ServletInputStream inputStream = request.getInputStream();
String body                    = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8); // body

// application/json 정보 조회
// controller 안에 private final ObjectMapper objectMapper = new ObjectMapper(); 코드 넣기
// @Getter, @Setter annotation이 있는 JsonData 클래스 만들기
ServletInputStream inputStream = request.getInputStream();
String body                    = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8); // body
JsonData jsonData              = objectMapper.readValue(body, JsonData.class);                  // JSON 오브젝트에 데이터 넣기
```

### Response (header)

```java
// start line 응답
response.setStatus(HttpServletResponse.SC_OK); // status

// header 응답
response.setHeader("Content-Type", "text/plain;charset=utf-8");             // content-type
response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate"); // cache
response.setHeader("Pragma", "no-cache");                                   // cache
response.setHeader("test-header", "test");                                  // 임의의 헤더 설정

// 그외 응답
response.setContentType("text/plain");  // content-type
response.setCharacterEncoding("utf-8"); // character encoding
response.setContentLength(2);           // content length (생략하면 자동생성하므로 주로 쓰이지 않음)

// 쿠키 세팅
// response.setHeader("Set-Cookie", "key=value; Max-Age=300");
Cookie cookie = new Cookie("key", "value");
cookie.setMaxAge(300);
response.addCookie(cookie);
```

### Response (body)

```java
// Rediect 응답
// response.setStatus(HttpServletResponse.SC_FOUND); // 302 (redirect)
// response.setHeader("Location", "/test.html");
response.sendRedirect("/test.html");

// text/plain 응답
response.setContentType("text/plain");     // text/plain 설정
response.setCharacterEncoding("utf-8");    // utf-8 설정

PrintWriter writer = response.getWriter(); // writer 생성
writer.println("hello!");

// text/html 응답
response.setContentType("text/html");      // text/html 설정
response.setCharacterEncoding("utf-8");    // utf-8 설정

PrintWriter writer = response.getWriter(); // writer 생성
writer.println("<html>");
writer.println("<body>");
writer.println(" <div>hello!</div>");
writer.println("</body>");
writer.println("</html>");

// application/json 응답
response.setHeader("content-type", "application/json");    // application/json 설정
response.setCharacterEncoding("utf-8");                    // utf-8 설정

JsonData jsonData = new JsonData();                        // JsonData 오브젝트 생성
jsonData.setFirstName("Gildong");
jsonData.setLastName("Hong");

String result = objectMapper.writeValueAsString(jsonData); // {"firstName":"Gildong","lastName":"Hong"}
PrintWriter writer = response.getWriter();                 // writer 생성
writer.write(result);
```
