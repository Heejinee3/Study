<br />

## Function Calling

Function callingì€ GPTì—ê²Œ í”„ë¡œê·¸ë˜ë¨¸ê°€ ë§Œë“  ì‹¤ì œ í•¨ìˆ˜(ê¸°ëŠ¥)ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ì‹œí‚¤ëŠ” ê¸°ëŠ¥

GPTê°€ ë‹¨ìˆœíˆ ë‹µì„ í…ìŠ¤íŠ¸ë¡œ ì£¼ëŠ” ê²Œ ì•„ë‹ˆë¼, ì™¸ë¶€ í•¨ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰ì‹œí‚¤ê³ , ê·¸ ê²°ê³¼ë¥¼ í™œìš©í•´ ë” ì •í™•í•œ ë‹µì„ ë§Œë“œëŠ” ê³¼ì •

<br />

## Get Current Time Tool (CLI)

- ì„¤ì¹˜

```python
pip install pytz
```

<br />

- ì½”ë“œ

```python
# gpt.py
from gpt_functions import get_current_time, tools
import os
from openai import OpenAI
from dotenv import load_dotenv
import json

env_path = "api_key.env"
load_dotenv(dotenv_path=env_path)

api_key = os.getenv("OPENAI_API_KEY")
client = OpenAI(api_key=api_key)

messages = [
    {"role": "system", "content": "ë„ˆëŠ” ì‚¬ìš©ìë¥¼ ë„ì™€ì£¼ëŠ” ìƒë‹´ì‚¬ì•¼."},
]

while True:
    user_input = input("ì‚¬ìš©ì\t: ")

    if user_input == "exit":
        break

    messages.append({"role": "user", "content": user_input})

    ai_response = client.chat.completions.create(
        model="gpt-4o",
        messages=messages,
        tools=tools, # ì‚¬ìš© ê°€ëŠ¥í•œ ë„êµ¬ ëª©ë¡ ì „ë‹¬
    )

    ai_message = ai_response.choices[0].message

    tool_calls = ai_message.tool_calls # AI ì‘ë‹µì— í¬í•¨ëœ tool_callsë¥¼ ê°€ì ¸ì˜´
    if tool_calls: # tool_callsê°€ ìˆëŠ” ê²½ìš°
        for tool_call in tool_calls:
            tool_name = tool_call.function.name # í•¨ìˆ˜ëª…
            tool_call_id = tool_call.id         # id
            arguments = json.loads(tool_call.function.arguments) # ë¬¸ìì—´ì„ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜

            if tool_name == "get_current_time": # tool_nameì´ "get_current_time"ì¼ ë–„
                messages.append({
                    "role": "function", # roleì„ "function"ìœ¼ë¡œ ì„¤ì •
                    "tool_call_id": tool_call_id,
                    "name": tool_name,
                    "content": get_current_time(timezone=arguments['timezone']),  # íƒ€ì„ì¡´ ì¶”ê°€
                })
        messages.append({"role": "system", "content": "ì´ì œ ì£¼ì–´ì§„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•  ì°¨ë¡€ë‹¤."})  # í•¨ìˆ˜ ì‹¤í–‰ ì™„ë£Œ ë©”ì‹œì§€ ì¶”ê°€
        ai_response = client.chat.completions.create(
            model="gpt-4o",
            messages=messages,
            tools=tools,
        ) # ë‹¤ì‹œ GPT ì‘ë‹µ ë°›ê¸°
        ai_message = ai_response.choices[0].message

    messages.append({
        "role": "assistant",
        "content": ai_message.content
    })  # AI ì‘ë‹µì„ ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€

    print("AI\t: " + ai_message.content) # AI ì‘ë‹µ ì¶œë ¥
```

```python
# gpt_functions.py
from datetime import datetime
import pytz

def get_current_time(timezone: str = 'Asia/Seoul'):
    tz = pytz.timezone(timezone) # íƒ€ì„ì¡´ ì„¤ì •
    now = datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
    now_timezone = f'{now} {timezone}'
    return now_timezone

tools = [
    {
        "type": "function",
        "function": {
            "name": "get_current_time",
            "description": "í•´ë‹¹ íƒ€ì„ì¡´ì˜ ë‚ ì§œì™€ ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.",
            "parameters": {
                "type": "object",
                "properties": {
                    'timezone': {
                        'type': 'string',
                        'description': 'í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ì„ ë°˜í™˜í•  íƒ€ì„ì¡´ì„ ì…ë ¥í•˜ì„¸ìš”. (ì˜ˆ: Asia/Seoul)',
                    },
                },
                "required": ['timezone'],
            },
        }
    },
]
```

<br />

- ë³€ìˆ˜ê°’

  <details>
    <summary>ai_message</summary>

  - ì¼ë°˜ ì§ˆë¬¸ì ì¸ ì§ˆë¬¸ì„ í–ˆì„ ë•Œ (ex. ì•ˆë…•!)

  ```json
  ChatCompletionMessage(
          content='ì•ˆë…•í•˜ì„¸ìš”! ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?',
          refusal=None,
          role='assistant',
          audio=None,
          function_call=None,
          tool_calls=None,
          annotations=[]
  )
  ```

  <br />

  - function callingì´ ë°œìƒí–ˆì„ ë•Œ (ex. ìš°ë¦¬ë‚˜ë¼ì˜ í˜„ì¬ ì‹œê°ì„ ì•Œë ¤ì¤˜)

  ```json
  ChatCompletionMessage(
          content=None,
          refusal=None,
          role='assistant',
          audio=None,
          function_call=None,
          tool_calls=[
                  ChatCompletionMessageToolCall(
                          id='call_2qCOB0kdklyKySbhxZknAJbS',
                          function=Function(
                                  arguments='{"timezone":"Asia/Seoul"}',
                                  name='get_current_time'
                          ),
                          type='function'
                  )
                      ],
          annotations=[]
  )
  ```

  <br />

  - function callingì´ ì—¬ëŸ¬ë²ˆ ë°œìƒí–ˆì„ ë•Œ (ex. ë¯¸êµ­, ì¼ë³¸, í˜¸ì£¼ì˜ í˜„ì¬ ì‹œê°ì„ ì•Œë ¤ì¤˜)

  ```json
  ChatCompletionMessage(
          content=None,
          refusal=None,
          role='assistant',
          audio=None,
          function_call=None,
          tool_calls=[
                  ChatCompletionMessageToolCall(
                          id='call_hRUzBxFrmsKHJ0lg9gNa7Pi8',
                          function=Function(
                                  arguments='{"timezone": "America/New_York"}',
                                  name='get_current_time'
                          ),
                          type='function'
                  ),
                  ChatCompletionMessageToolCall(
                          id='call_8Hxi2FoxWLrYsGvzQ3WNtrcv',
                          function=Function(
                                  arguments='{"timezone": "Asia/Tokyo"}',
                                  name='get_current_time'
                          ),
                          type='function'
                  ),
                  ChatCompletionMessageToolCall(
                          id='call_B9d22YWdlVZ1b5oCM3o9lXsj',
                          function=Function(
                                  arguments='{"timezone": "Australia/Sydney"}',
                                  name='get_current_time'
                          ),
                          type='function'
                  )
          ],
          annotations=[]
  )
  ```

  </details>

  <details>
    <summary>messages</summary>

  ```json
  [
    {
      "role": "system",
      "content": "ë„ˆëŠ” ì‚¬ìš©ìë¥¼ ë„ì™€ì£¼ëŠ” ìƒë‹´ì‚¬ì•¼."
    },
    {
      "role": "user",
      "content": "ì§€ê¸ˆ ëª‡ì‹œì•¼"
    },
    {
      "role": "assistant",
      "content": "ì–´ëŠ ì§€ì—­ì˜ ì‹œê°„ì„ ì•Œê³  ì‹¶ìœ¼ì‹ ê°€ìš”? ì˜ˆë¥¼ ë“¤ì–´, ì„œìš¸ì˜ ì‹œê°„ì„ ì•Œê³  ì‹¶ìœ¼ì‹œë©´ \"Asia/Seoul\"ì´ë¼ê³  ë§ì”€í•´ ì£¼ì„¸ìš”."
    },
    {
      "role": "user",
      "content": "ì„œìš¸ ì•Œê³ ì‹¶ì–´"
    },
    {
      "role": "function",
      "tool_call_id": "call_16f9He7WsOUvrTifRql9Yeu1",
      "name": "get_current_time",
      "content": "2025-06-20 02:30:08 Asia/Seoul"
    },
    {
      "role": "system",
      "content": "ì´ì œ ì£¼ì–´ì§„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•  ì°¨ë¡€ë‹¤."
    },
    {
      "role": "assistant",
      "content": "ì„œìš¸ì˜ í˜„ì¬ ì‹œê°„ì€ 2025ë…„ 6ì›” 20ì¼ 02ì‹œ 30ë¶„ì…ë‹ˆë‹¤."
    },
    {
      "role": "user",
      "content": "ë„ì¿„ë‘ ë¯¸êµ­ë„ ì•Œë ¤ì¤˜"
    },
    {
      "role": "function",
      "tool_call_id": "call_jNmaqfztj6frRbiR1oeJ9DP3",
      "name": "get_current_time",
      "content": "2025-06-20 02:30:24 Asia/Tokyo"
    },
    {
      "role": "function",
      "tool_call_id": "call_3SpJUC9dA6fn8FafiEmxe7KH",
      "name": "get_current_time",
      "content": "2025-06-19 13:30:24 America/New_York"
    },
    {
      "role": "system",
      "content": "ì´ì œ ì£¼ì–´ì§„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•  ì°¨ë¡€ë‹¤."
    },
    {
      "role": "assistant",
      "content": "ë„ì¿„ì˜ í˜„ì¬ ì‹œê°„ì€ 2025ë…„ 6ì›” 20ì¼ 02ì‹œ 30ë¶„ì´ë©°, ë‰´ìš•ì˜ í˜„ì¬ ì‹œê°„ì€ 2025ë…„ 6 ì›” 19ì¼ 13ì‹œ 30ë¶„ì…ë‹ˆë‹¤."
    }
  ]
  ```

  </details>

<br />

## Get Current Time Tool (Streamlit)

- ì„¤ì¹˜

```python
pip install streamlit
```

<br />

- ì½”ë“œ

```python
# gpt.py
from gpt_functions import get_current_time, tools
from openai import OpenAI
from dotenv import load_dotenv
import os
import json
import streamlit as st

env_path = "api_key.env"
load_dotenv(dotenv_path=env_path)

api_key = os.getenv("OPENAI_API_KEY")
client = OpenAI(api_key=api_key)

st.title("ğŸ’¬ Chatbot")

if "messages" not in st.session_state:
    st.session_state["messages"] = [
        {"role": "system", "content": "ë„ˆëŠ” ì‚¬ìš©ìë¥¼ ë„ì™€ì£¼ëŠ” ìƒë‹´ì‚¬ì•¼."},  # ì´ˆê¸° ì‹œìŠ¤í…œ ë©”ì‹œì§€
    ]

for msg in st.session_state.messages:
    if msg["role"] == "assistant" or msg["role"] == "user": # assistant í˜¹ì€ user ë©”ì‹œì§€ì¸ ê²½ìš°ë§Œ
        st.chat_message(msg["role"]).write(msg["content"])

if user_input := st.chat_input():    # ì‚¬ìš©ì ì…ë ¥ ë°›ê¸°
    st.session_state.messages.append({"role": "user", "content": user_input})  # ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€
    st.chat_message("user").write(user_input)  # ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ë¸Œë¼ìš°ì €ì—ì„œë„ ì¶œë ¥

    ai_response = client.chat.completions.create(
        model="gpt-4o",
        messages=st.session_state.messages,
        tools=tools,
    )
    ai_message = ai_response.choices[0].message

    tool_calls = ai_message.tool_calls  # AI ì‘ë‹µì— í¬í•¨ëœ tool_callsë¥¼ ê°€ì ¸ì˜´
    if tool_calls: # tool_callsê°€ ìˆëŠ” ê²½ìš°
        for tool_call in tool_calls:
            tool_name = tool_call.function.name # í•¨ìˆ˜ëª…
            tool_call_id = tool_call.id         # id
            arguments = json.loads(tool_call.function.arguments) # ë¬¸ìì—´ì„ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜

            if tool_name == "get_current_time":  # ë§Œì•½ tool_nameì´ "get_current_time"ì´ë¼ë©´
                st.session_state.messages.append({
                    "role": "function",
                    "tool_call_id": tool_call_id,
                    "name": tool_name,
                    "content": get_current_time(timezone=arguments['timezone']),
                })
        st.session_state.messages.append({"role": "system", "content": "ì´ì œ ì£¼ì–´ì§„ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•  ì°¨ë¡€ë‹¤."})
        ai_response = client.chat.completions.create(
            model="gpt-4o",
            messages=st.session_state.messages,
            tools=tools,
        ) # ë‹¤ì‹œ GPT ì‘ë‹µ ë°›ê¸°
        ai_message = ai_response.choices[0].message

    st.session_state.messages.append({
        "role": "assistant",
        "content": ai_message.content
    })  # AI ì‘ë‹µì„ ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€

    st.chat_message("assistant").write(ai_message.content)  # ë¸Œë¼ìš°ì €ì— ë©”ì‹œì§€ ì¶œë ¥
```

<br />

- ì‹¤í–‰

```python
streamlit run gpt.py
```

<br />
<br />
<br />

[ì¶œì²˜: ì´ì„±ìš©, ã€ŒDo it! LLMì„ í™œìš©í•œ AI ì—ì´ì „íŠ¸ ê°œë°œ ì…ë¬¸ - GPT API+ë”¥ì‹œí¬+ë¼ë§ˆ+ë­ì²´ì¸+ë­ê·¸ë˜í”„+RAGã€, ì´ì§€ìŠ¤í¼ë¸”ë¦¬ì‹±](https://www.easyspub.co.kr/20_Menu/BookView/764/PUB)

<br />
