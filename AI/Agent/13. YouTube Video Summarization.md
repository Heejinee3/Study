<br />

## ì„¤ì¹˜

```python
pip install youtube-search
pip install youtube_transcript_api
pip install streamlit
pip install python-dotenv
```

<br />

## ì‚¬ìš©ë²•

ì‚¬ìš©ë²• 1.

```python
from youtube_search import YoutubeSearch

videos = YoutubeSearch("ë¯¸êµ­ ëŒ€ì„ ", max_results=2).to_dict()

print(videos)
```

```python
[
		{
				'id': '4A3P9Tgm8wc',
				'thumbnails': [
						'https://i.ytimg.com/vi/4A3P9Tgm8wc/hq720.jpg?sqp=-oaymwEjCOgCEMoBSFryq4qpAxUIARUAAAAAGAElAADIQj0AgKJDeAE=&rs=AOn4CLBiKa6FlGtJbPpVcHb4Nkfj_G7yqQ', 'https://i.ytimg.com/vi/4A3P9Tgm8wc/hq720.jpg?sqp=-oaymwEXCNAFEJQDSFryq4qpAwkIARUAAIhCGAE=&rs=AOn4CLA9dp_amuxkebdEB0E_Yg87rC4ZQA'
				],
				'title': '[2020 ë¯¸êµ­ ëŒ€ì„ ] í‘œ ì ê²Œ ë°›ê³ ë„ ëŒ€í†µë ¹ ëœë‹¤? ë³µì¡í•œ ì„ ê±°ì œë„ 6ë¶„ ì´ì •ë¦¬ â™ Won Less, but Elected Anyways? / ë¹„ë””ì˜¤ë¨¸ê·¸',
				'long_desc': None,
				'channel': 'ë¹„ë””ì˜¤ë¨¸ê·¸ - VIDEOMUG',
				'duration': '5:50',
				'views': 'ì¡°íšŒìˆ˜ 516,504íšŒ',
				'publish_time': '4ë…„ ì „',
				'url_suffix': '/watch?v=4A3P9Tgm8wc&pp=ygUN66-46rWtIOuMgOyEoA%3D%3D'
		},
		{
				'id': 'lOgs1v2Esi4',
				'thumbnails': [
						'https://i.ytimg.com/vi/lOgs1v2Esi4/hq720.jpg?sqp=-oaymwEjCOgCEMoBSFryq4qpAxUIARUAAAAAGAElAADIQj0AgKJDeAE=&rs=AOn4CLBwAaGUZJXpjuxEnGrKrTHv9qg2xA', 'https://i.ytimg.com/vi/lOgs1v2Esi4/hq720.jpg?sqp=-oaymwEXCNAFEJQDSFryq4qpAwkIARUAAIhCGAE=&rs=AOn4CLCYrSHXAqldzTxPXoa1Sc1humU9Vw'
				],
				'title': 'ë¯¸êµ­ ëŒ€ì„  í† ë¡ , ìµœì•…ì˜ 10ë¶„',
				'long_desc': None,
				'channel': 'ìŠˆì¹´ì›”ë“œ',
				'duration': '23:00',
				'views': 'ì¡°íšŒìˆ˜ 1,791,855íšŒ',
				'publish_time': '1ë…„ ì „',
				'url_suffix': '/watch?v=lOgs1v2Esi4&pp=ygUN66-46rWtIOuMgOyEoA%3D%3D'
		},
]
```

<p></p>

ì‚¬ìš©ë²• 2.

```python
from youtube_search import YoutubeSearch
from langchain_community.document_loaders import YoutubeLoader

videos = YoutubeSearch("ë¯¸êµ­ ëŒ€ì„ ", max_results=2).to_dict()

video_url = 'http://youtube.com' + videos[1]['url_suffix']

loader = YoutubeLoader.from_youtube_url(
    video_url,
    language=['ko', 'en'] # ìë§‰ ì–¸ì–´
)

print(loader.load())
```

```python
[
		Document(
				metadata={'source': 'lOgs1v2Esi4'},
				page_content="ì, ë§ˆì§€ë§‰ ì£¼ì œì…ë‹ˆë‹¤ ì´ê±°ëŠ” ë­ ì¬ë°ŒëŠ”.."
		)
]
```

<br />

## YouTube Video Summarization

### ìœ íŠœë¸Œ ì˜ìƒ ìë§‰ ìš”ì•½ ìë™í™”

```python
from youtube_search import YoutubeSearch
from langchain_community.document_loaders import YoutubeLoader
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate
from langchain.chains.combine_documents import create_stuff_documents_chain
from tqdm import tqdm
from dotenv import load_dotenv

################ Step 1. ìœ íŠœë¸Œ ê²€ìƒ‰ ë° ìë§‰ ë¶ˆëŸ¬ì˜¤ê¸° ################

videos = YoutubeSearch("ë¯¸êµ­ ëŒ€ì„ ", max_results=2).to_dict()

for v in videos:
    v['video_url'] = 'https://youtube.com' + v['url_suffix']

    loader = YoutubeLoader.from_youtube_url(
        v['video_url'],
        language=['ko', 'en']
    )

    v['content'] = loader.load()

################ Step 2. LLM ëª¨ë¸ ì„¤ì • ë° ìš”ì•½ ì²´ì¸ êµ¬ì„± ################

env_path = "api_key.env"
load_dotenv(dotenv_path=env_path)

model = ChatOpenAI(model="gpt-4o-mini")

prompt = ChatPromptTemplate.from_messages(
    [("system", "ë‹¤ìŒ ì˜ìƒì— ëŒ€í•œ ìš”ì•½ì„ í•œêµ­ì–´ë¡œ ë§Œë“¤ì–´ì¤˜ :\\n\\n{context}")]
)

chain = create_stuff_documents_chain(model, prompt)

for v in tqdm(videos):
    v['summary'] = chain.invoke({"context": v['content']})

################ Step 3. ìš”ì•½ ê²°ê³¼ ì¶œë ¥ ################

for v in videos:
    print("=" * 80)
    print(f"Title: {v['title']}")
    print(f"URL: {v['video_url']}")
    print("\nSummary:")
    print(v['summary'])
    print("=" * 80 + "\n")
```

<br />

### ìœ íŠœë¸Œ ê²€ìƒ‰ ê¸°ë°˜ AI ì±—ë´‡

```python
from langchain_openai import ChatOpenAI
from langchain_core.messages import SystemMessage, HumanMessage, AIMessage
from langchain_core.tools import tool
from langchain_community.document_loaders import YoutubeLoader

import streamlit as st
from youtube_search import YoutubeSearch
from typing import List
from dotenv import load_dotenv

# ëª¨ë¸ ì´ˆê¸°í™”
env_path = "api_key.env"
load_dotenv(dotenv_path=env_path)

llm = ChatOpenAI(model="gpt-4o-mini")

# ë„êµ¬ í•¨ìˆ˜ ì •ì˜
@tool
def get_youtube_search(query: str) -> List:
    """
    ìœ íŠœë¸Œ ê²€ìƒ‰ì„ í•œ ë’¤, ì˜ìƒë“¤ì˜ ë‚´ìš©ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜.

    Args:
        query (str): ê²€ìƒ‰ì–´

    Returns:
        List: ê²€ìƒ‰ ê²°ê³¼
    """
    videos = YoutubeSearch(query, max_results=5).to_dict()

    # 1ì‹œê°„ ì´ìƒì˜ ì˜ìƒì€ ìŠ¤í‚µ (59:59ê°€ ìµœëŒ€ ê¸¸ì´)
    videos = [video for video in videos if len(video['duration']) <= 5]

    for video in videos:
        video_url = 'http://youtube.com' + video['url_suffix']

        loader = YoutubeLoader.from_youtube_url(
            video_url,
            language=['ko', 'en']
        )

        video['video_url'] = video_url
        video['content'] = loader.load()

    return videos

# ë„êµ¬ ë°”ì¸ë”©
tools = [get_youtube_search]
tool_dict = {"get_youtube_search": get_youtube_search}
llm_with_tools = llm.bind_tools(tools)

# ì‚¬ìš©ìì˜ ë©”ì‹œì§€ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ í•¨ìˆ˜
def get_ai_response(messages):
    response = llm_with_tools.stream(messages) # llm.stream()ì„ llm_with_tools.stream()ë¡œ ë³€ê²½

    gathered = None
    for chunk in response:
        yield chunk

        if gathered is None:
            gathered = chunk
        else:
            gathered += chunk

    if gathered.tool_calls:
        st.session_state.messages.append(gathered)

        for tool_call in gathered.tool_calls:
            selected_tool = tool_dict[tool_call['name']]
            tool_msg = selected_tool.invoke(tool_call)
            print(tool_msg, type(tool_msg))
            st.session_state.messages.append(tool_msg)

        for chunk in get_ai_response(st.session_state.messages):
            yield chunk

# Streamlit ì•±
st.title("ğŸ’¬ GPT-4o Langchain Chat")

# ìŠ¤íŠ¸ë¦¼ë¦¿ session_stateì— ë©”ì‹œì§€ ì €ì¥
if "messages" not in st.session_state:
    st.session_state["messages"] = [
        SystemMessage("ë„ˆëŠ” ì‚¬ìš©ìë¥¼ ë•ê¸° ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ëŠ” ì¸ê³µì§€ëŠ¥ ë´‡ì´ë‹¤. "),
        AIMessage("How can I help you?")
    ]

# ìŠ¤íŠ¸ë¦¼ë¦¿ í™”ë©´ì— ë©”ì‹œì§€ ì¶œë ¥
for msg in st.session_state.messages:
    if msg.content:
        if isinstance(msg, AIMessage):
            st.chat_message("assistant").write(msg.content)
        elif isinstance(msg, HumanMessage):
            st.chat_message("user").write(msg.content)

# ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
if prompt := st.chat_input():
    st.chat_message("user").write(prompt)
    st.session_state.messages.append(HumanMessage(prompt))

    response = get_ai_response(st.session_state["messages"])

    result = st.chat_message("assistant").write_stream(response)
    st.session_state["messages"].append(AIMessage(result))

```

<br />
<br />
<br />

[ì¶œì²˜: ì´ì„±ìš©, ã€ŒDo it! LLMì„ í™œìš©í•œ AI ì—ì´ì „íŠ¸ ê°œë°œ ì…ë¬¸ - GPT API+ë”¥ì‹œí¬+ë¼ë§ˆ+ë­ì²´ì¸+ë­ê·¸ë˜í”„+RAGã€, ì´ì§€ìŠ¤í¼ë¸”ë¦¬ì‹±](https://www.easyspub.co.kr/20_Menu/BookView/764/PUB)

<br />
